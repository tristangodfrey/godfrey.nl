<script>
document.addEventListener('DOMContentLoaded', function() {
  // Scroll animation speed in milliseconds
  const scrollSpeed = 750;

  // Smooth scroll function
  function smoothScrollTo(targetPosition, duration) {
    const startPosition = window.scrollY;
    const distance = targetPosition - startPosition;
    let start = null;

    function step(timestamp) {
      if (!start) start = timestamp;
      const progress = timestamp - start;
      const nextScrollY = easeInOutQuad(progress, startPosition, distance, duration);
      window.scrollTo(0, nextScrollY);
      if (progress < duration) {
        window.requestAnimationFrame(step);
      } else {
        window.scrollTo(0, targetPosition);
      }
    }

    function easeInOutQuad(t, b, c, d) {
      t /= d / 2;
      if (t < 1) return c / 2 * t * t + b;
      t--;
      return -c / 2 * (t * (t - 2) - 1) + b;
    }

    window.requestAnimationFrame(step);
  }

  // Handle down arrow click
  const scrollArrow = document.querySelector('a[href="#first-post"]');
  if (scrollArrow) {
    scrollArrow.addEventListener('click', function(e) {
      e.preventDefault();
      const targetId = this.getAttribute('href');
      const target = document.querySelector(targetId);
      if (target) {
        // On list pages, scroll to first post
        const targetPosition = target.getBoundingClientRect().top + window.scrollY;
        smoothScrollTo(targetPosition, scrollSpeed);
      } else {
        // On other pages (like post detail), scroll past the header
        const header = document.querySelector('header');
        if (header) {
          const headerHeight = header.offsetHeight;
          smoothScrollTo(headerHeight, scrollSpeed);
        }
      }
    });
  }

  // Auto-scroll on post pages when navigating from list view
  window.addEventListener('load', function() {
    const referrer = document.referrer;
    const isPostPage = document.querySelector('article.flex-l');
    if (isPostPage && referrer && (referrer.includes('/posts') || referrer.includes('/blog'))) {
      // Smooth scroll past the header
      const header = document.querySelector('header');
      if (header) {
        const headerHeight = header.offsetHeight;
        smoothScrollTo(headerHeight, scrollSpeed);
      }
    }
  });
});
</script>
